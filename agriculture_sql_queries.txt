## Agriculture Queries (Snowflake) 

CREATE database PowerBI;

create schema PBI_Data;

create table PBI_Dataset (
Year int,	Location string,	Area	int,
Rainfall	float, Temperature	float, Soil_type string,
Irrigation	string, yeilds	int,Humidity	float,
Crops	string,price	int,Season string



);

select * from PBI_Dataset;

//drop database test;

create stage PowerBI.PBI_Data.pbi_stage
url = 's3://bucketname'
storage_integration = PBI_Integration

//desc stage s1

//drop stage s1;


copy into PBI_Dataset 
from @pbi_stage
file_format = (type=csv field_delimiter=',' skip_header=1 )
on_error = 'continue'

list @pbi_stage

SELECT year, count(*) FROM PBI_Dataset
GROUP BY YEAR
ORDER BY YEAR;

CREATE TABLE Agriculture AS
SELECT * FROM PBI_Dataset;

SELECT * FROM Agriculture;

UPDATE Agriculture
SET RAINFALL = 1.1 * RAINFALL;

UPDATE Agriculture
SET area = 0.9 * area;

ALTER TABLE AGRICULTURE
add YEAR_GROUP STRING;

UPDATE Agriculture 
SET YEAR_GROUP = 'Y1'
WHERE YEAR >= 2004 AND YEAR <= 2009

UPDATE Agriculture 
SET YEAR_GROUP = 'Y2'
WHERE YEAR >= 2010 AND YEAR <= 2015

UPDATE Agriculture 
SET YEAR_GROUP = 'Y3'
WHERE YEAR >= 2016 AND YEAR <= 2019

SELECT * FROM Agriculture;

// Rainfall_Groups
// Min 255 Max 4103

// Rainfall 255 & 1200 - Low
// Rainfall 1200 & 2800 - Medium
// Rainfall 2800 & 4103 - High

ALTER TABLE AGRICULTURE
ADD Rainfall_Groups String;

// 1st update
update agriculture
set rainfall_groups = 'Low'
where rainfall >= 255 and rainfall < 1200;

// 2nd update
update agriculture
set rainfall_groups = 'Medium'
where rainfall >= 1200 and rainfall < 2800;

// 3rd update
update agriculture
set rainfall_groups = 'High'
where rainfall >= 2800;


